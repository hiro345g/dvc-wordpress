# docker イメージについて

PHP や WordPress 用の Docker イメージについて、選定するにあたって知っておく必要がある事項について説明します。

## PHP の公式 Docker イメージ

PHP の公式 Docker イメージのタグの命名規則について

### タグに含まれるキーワードの意味

| キーワード | 意味            | 特徴                                              |
| ---------- | --------------- | ------------------------------------------------- |
| 8.2.30     | PHPのバージョン | 特定のマイナー・パッチバージョン                  |
| trixie     | OSの種類        | Debian 13 (Trixie) ベース                         |
| cli        | 実行形態        | コマンドライン実行用。Webサーバー機能はなし       |
| fpm        | 実行形態        | PHP-FPM（FastCGI Process Manager）                |
| apache     | 実行形態        | ApacheとPHPがセットになったもの（mod_php）        |
| zts        | 特殊仕様        | マルチスレッド環境でPHPを動かすための特殊なビルド |

trixie を省略すると、通常その時点の最新安定版 Debian（2026年2月時点では Bookworm）

fpm は、Nginx など別の Web サーバーと連携して使う場合。

apache は、別途 Web サーバー用コンテナを用意する必要がなく、これ一つでWebサーバーとして起動可能。

zts は **Zend Thread Safety** の略。通常（Parallel拡張などを使わない限り）は使いません。

### カテゴリ別の違い（マッピング）

イメージを役割ごとに整理すると以下のようになります。

**A. Webサーバー一体型 (Apache)**:

- `php:8.2.30-apache-trixie`
- `php:8.2.30-apache`

> **用途:** 手軽にPHP環境を作りたい時。設定が楽ですが、Nginx + FPM構成に比べるとリソース消費が大きくなる傾向があります。

**B. 高パフォーマンスWeb用 (FPM)**:

- `php:8.2.30-fpm-trixie`
- `php:8.2.30-fpm`

> **用途:** 本番環境の標準。Nginxなどのリバースプロキシと組み合わせて使用します。

**C. コマンドライン・ツール用 (CLI)**:

- `php:8.2.30-cli-trixie`（`php:8.2.30-trixie`）
- `php:8.2.30-cli`（`php:8.2.30`）

> **用途:** `composer`の実行、Laravelの`artisan`コマンド、バッチ処理など。Webサーバー機能は含まれません。

### D. 特殊用途 (ZTS)

- `php:8.2.30-zts-trixie`
- `php:8.2.30-zts`

> **用途:** スレッドセーフが必要な特殊な拡張機能を利用する場合のみ選択します。一般的なWeb開発ではほぼ使いません。

### PHP の Docker イメージ選択方法

- とりあえず動かしたい: `php:8.2.30-apache`
- Web サーバーとは別に動かしたい: `php:8.2.30-fpm`
- 使用環境にあわせて特定の OS バージョン（Debian 13）に固定したい: 末尾に `-trixie` など OS 情報が付くものを選択

## WordPress の Docker イメージ

WordPress イメージの選択基準は「**インフラ構成をどこまで自分で行うか**」に集約されます。
なお、どのイメージを選んでも、WordPress には MariaDB または MySQL のコンテナが別途必要です。

大きく分けて、公式イメージ（`wordpress`）と、サードパーティ製で定評のあるBitnamiイメージ（`bitnami/wordpress`）があります。

### WordPress の Docker イメージの比較

| イメージ名                 | Webサーバー     | 特徴・用途               |
| -------------------------- | --------------- | ------------------------ |
| `wordpress:php8.3-apache`  | 内蔵 (Apache)   | 最も手軽                 |
| `wordpress:php8.3-fpm`     | なし (別途必要) | パフォーマンス重視       |
| `bitnami/wordpress:latest` | 内蔵 (Apache)   | セキュリティと運用性重視 |

`wordpress:php8.3-apache` を使うと、Docker コンテナ1つで WordPress が起動します。設定がシンプルで、初心者や開発環境に最適です。

`wordpress:php8.3-fpm` は Nginx などの Web サーバーコンテナを別途用意する必要があります。本番環境でよく使われる構成です。

`bitnami/wordpress:latest` には、独自ツールが含まれており、非ルートユーザーでの実行などセキュリティ設定が厳格です。

### WordPress の Docker イメージのメリット・デメリット

**wordpress:php8.3-apache (公式)**:

公式が提供する「全部入り」モデルです。

- メリット: `docker run` してデータベースに繋ぐだけで、すぐにブラウザでアクセス可能です。`.htaccess` がそのまま使えます。
- デメリット: 1つのコンテナで多くの処理を行うため、大量のアクセスを捌く際の細かなチューニングには不向きです。

**wordpress:php8.3-fpm (公式)**:

PHP の処理に特化した「エンジンのみ」のモデルです。

- メリット: Webサーバー（Nginx）とPHP処理を分離できるため、リソース配分が効率的になり、高速なレスポンスが期待できます。
- デメリット: 単体では動きません。`compose.yaml` などで、Nginx コンテナの設定（FastCGI の設定）を書く必要があります。

**bitnami/wordpress:latest**:

VM イメージなどで有名な Bitnami がメンテナンスしているイメージです。

- メリット: 初期状態でセキュリティ設定がしっかりしており、環境変数だけでプラグインのインストールや初期設定を自動化する機能が豊富です。
- デメリット: 公式イメージとファイル配置（パス）が異なるため、ネット上の一般的なカスタマイズ記事がそのまま流用できないことがあります。

### WordPress の Docker イメージ選択方法

- とにかく早く立ち上げたい: `wordpress:php8.3-apache`
- 本格的なサイトを構築したい、Nginxの知識がある: `wordpress:php8.3-fpm` （Nginx コンテナとセットで運用）
- 企業のセキュリティ要件が厳しい、または Kubernetes などで運用したい: `bitnami/wordpress:latest`

## FrankenPHP の Docker イメージ

FrankenPHP は、現代的な Go 言語製の Web サーバー Caddy をベースにした最新の PHP アプリケーションサーバーです。

一言でいうと、**「Apache の使いやすさ」と「Nginx + FPM 以上の実行速度」を両立し、さらに現代的な機能（HTTPS 自動化など）を全部盛りした欲張りセット**です。

### FrankenPHP の Docker イメージの選択肢

公式のイメージ（`dunglas/frankenphp`）には、主に以下のバリエーションがあります。

| タグの構成例       | ベース OS         | 特徴                                                     |
| ------------------ | ----------------- | -------------------------------------------------------- |
| `latest`, `php8.3` | Debian (Bookworm) | 標準的な選択。互換性が高く、迷ったらこれです。           |
| `php8.3-alpine`    | Alpine Linux      | 軽量・最小限。コンテナサイズを小さくしたい本番環境向け。 |
| `php8.3-trixie`    | Debian (Trixie)   | 次期 Debian ベース。最新のパッケージを使いたい場合。     |
| `builder` 系       | -                 | カスタム拡張機能をビルドするためのベースイメージ。       |

### 他のイメージとの比較：なぜ FrankenPHP を使うのか？

すでに挙げられた `php:8.2-apache` や `php:8.2-fpm` と比較すると、以下の点が「利用する価値」となります。

1. パフォーマンス：圧倒的な「Worker Mode」
2. 構成のシンプルさ：コンテナ 1 つで完結
3. モダンな標準機能

**パフォーマンス：圧倒的な「Worker Mode」**:

従来の PHP は、リクエストのたびにプログラムを最初から読み込み直します（ブートストラップ）。
FrankenPHP の **Worker Mode** を使うと、アプリをメモリ上に常駐させることができるため、Laravel などの重いフレームワークでも**数倍（2〜3倍以上）の高速化**が期待できます。これは `php-fpm` には真似できない芸当です。

**構成のシンプルさ：コンテナ 1 つで完結**:

- php-fpm: Web サーバー（Nginx）と PHP の 2 つのコンテナが必要。
- php-apache: 1つで済むが、性能や拡張性に限界がある。
- FrankenPHP: 1つのコンテナで、Web サーバー（Caddy）と高速な PHP 実行環境の両方を提供します。設定ファイル（Caddyfile）も非常に読みやすく、管理が楽です。

**モダンな標準機能**:

`php-fpm` や `apache` 単体では設定が面倒な機能が、最初から組み込まれています。

- 自動 HTTPS: Let's Encrypt と連携し、証明書の取得・更新を勝手にやってくれます。
- HTTP/3 対応: 最新の通信プロトコルをデフォルトでサポート。
- 資産のバイナリ化: アプリと PHP 実行環境を 1 つの実行ファイル（バイナリ）に固める、Go 言語のような配布スタイルも可能です。

### 比較まとめ：どれをいつ使う？

| 比較項目       | PHP 公式 (Apache) | PHP 公式 (FPM)         | **FrankenPHP**                |
| -------------- | ----------------- | ---------------------- | ----------------------------- |
| **学習コスト** | 低（かんたん）    | 中（Nginx 設定が必要） | **低〜中**（新しいが簡単）    |
| **実行速度**   | 普通              | 速い                   | **爆速** (Worker Mode 使用時) |
| **構成**       | 1 コンテナ        | 2 コンテナ (Nginx+FPM) | **1 コンテナ**                |
| **モダン機能** | 少ない            | 少ない                 | **豊富** (HTTP/3, 自動HTTPS)  |

**FrankenPHP を使うべき時:**

- Laravel や Symfony などのフレームワークを最高速で動かしたい。
- コンテナの数を減らして構成をシンプルに保ちたい。
- 開発環境と本番環境で同じ最新の Caddy サーバー構成を使いたい。

**PHP 公式 (FPM) を使うべき時**:

- 長年の実績がある「枯れた（安定した）」技術を使いたい。
- Nginx の高度なキャッシュ設定や複雑なルーティング設定がすでに手元にある。

**WordPress 公式を使うべき時**:

- WordPress の標準的なアップデート手順やコミュニティのナレッジをそのまま活用したい（※FrankenPHP 版の WordPress イメージ「FrankenWP」も存在しますが、まだ一般的ではありません）。

**結論**:

これから新しいプロジェクト（特に Laravel 等）を始めるなら、**FrankenPHP は最も有力な選択肢**のひとつです。逆に、既存の Apache/Nginx 設定に依存している古いアプリの移行なら、まずは公式 FPM から入るのが無難です。
